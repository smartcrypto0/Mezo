---
import config from 'virtual:starlight/user-config';
---
{
  // Open Graph + Twitter Card meta
}
{
  (() => {
    const siteHref = Astro.site?.href ?? 'https://mezo.org/docs';
    const base = new URL(siteHref);
    const origin = base.origin;
    const pageUrl = origin + Astro.url.pathname;
    const fm = (Astro.props as any)?.frontmatter ?? {};
    const pageTitle = fm.title ?? (Astro.props as any)?.title ?? 'Mezo Documentation';
    const defaultDesc = 'Official Mezo documentation: Wallet setup, asset bridging, MUSD borrowing guides, and developer resources. This is your complete guide to banking on yourself.';
    const pageDescription = fm.description ?? (Astro.props as any)?.description ?? defaultDesc;
    const ogImage = 'https://mezo.org/docs/images/mainnet/gitbookbanner.png';

    return (
      <>
        <link rel="canonical" href={pageUrl} />
        <meta name="description" content={pageDescription} />
        <meta property="og:type" content="article" />
        <meta property="og:site_name" content="Mezo Documentation" />
        <meta property="og:title" content={pageTitle} />
        <meta property="og:description" content={pageDescription} />
        <meta property="og:url" content={pageUrl} />
        <meta property="og:image" content={ogImage} />
        <meta property="og:image:alt" content="Mezo" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@MezoNetwork" />
        <meta name="twitter:title" content={pageTitle} />
        <meta name="twitter:description" content={pageDescription} />
        <meta name="twitter:image" content={ogImage} />
      </>
    );
  })()
}
{
  // Server-rendered JSON-LD for WebPage + TechArticle
}
{
  (() => {
    const siteHref = Astro.site?.href ?? 'https://mezo.org/docs';
    const base = new URL(siteHref);
    const origin = base.origin; // https://mezo.org
    const url = origin + Astro.url.pathname; // absolute page URL
    const fm = (Astro.props as any)?.frontmatter ?? {};
    const title = fm.title ?? (Astro.props as any)?.title ?? 'Mezo Documentation';
    const description = fm.description ?? (Astro.props as any)?.description ?? 'Mezo Documentation';
    const webPage = {
      '@context': 'https://schema.org',
      '@type': ['WebPage', 'TechArticle'],
      headline: title,
      name: title,
      description,
      url,
      mainEntityOfPage: url,
      publisher: {
        '@type': 'Organization',
        name: 'Mezo',
        logo: {
          '@type': 'ImageObject',
          url: 'https://raw.githubusercontent.com/mezo-org/documentation/main/src/assets/Mezo-Mark-Red.svg',
        },
        sameAs: [
          'https://github.com/mezo-org',
          'https://x.com/MezoNetwork',
          'https://discord.mezo.org',
        ],
      },
    };
    return <script type="application/ld+json" set:html={JSON.stringify(webPage)} />;
  })()
}

{
  // Server-rendered JSON-LD for BreadcrumbList
}
{
  (() => {
    const siteHref = Astro.site?.href ?? 'https://mezo.org/docs';
    const origin = new URL(siteHref).origin; // https://mezo.org
    const path = Astro.url.pathname.replace(/\/$/, '');
    const parts = path.split('/').filter(Boolean);
    if (!parts.length) return null;
    const labelMap: Record<string, string> = {
      docs: 'Documentation',
      users: 'User Documentation',
      developers: 'Developer Documentation',
      mainnet: 'Mainnet',
      musd: 'MUSD',
      mats: 'mats',
      features: 'Features',
      resources: 'Resources',
      'getting-started': 'Getting Started',
      introduction: 'Introduction',
      bridge: 'Bridge',
      architecture: 'Architecture',
      oracles: 'Oracles',
    };
    const fm = (Astro.props as any)?.frontmatter ?? {};
    const finalTitle = fm.title ?? (Astro.props as any)?.title;
    const items: any[] = [];
    let acc = '';
    parts.forEach((seg, idx) => {
      acc += '/' + seg;
      const isLast = idx === parts.length - 1;
      const name = isLast && finalTitle ? finalTitle : (labelMap[seg] ?? seg.replace(/-/g, ' '));
      items.push({
        '@type': 'ListItem',
        position: idx + 1,
        name,
        item: origin + acc + '/',
      });
    });
    const breadcrumb = {
      '@context': 'https://schema.org',
      '@type': 'BreadcrumbList',
      itemListElement: items,
    };
    return <script type="application/ld+json" set:html={JSON.stringify(breadcrumb)} />;
  })()
}

{
  // SSR HowTo for bridging page
}
{
  (() => {
    const siteHref = Astro.site?.href ?? 'https://mezo.org/docs';
    const origin = new URL(siteHref).origin;
    const path = Astro.url.pathname.replace(/\/$/, '');
    if (path !== '/docs/users/getting-started/bridging') return null;
    const url = origin + path;
    const steps = [
      { '@type': 'HowToStep', position: 1, name: 'Open Mezo App and sign in', text: 'Go to mezo.org/overview and sign in with a supported wallet.' },
      { '@type': 'HowToStep', position: 2, name: 'Add funds', text: 'Click Add funds and select the asset you want to bridge and the amount.' },
      { '@type': 'HowToStep', position: 3, name: 'Review and confirm', text: 'Review transfer details and confirm the transaction in your wallet.' },
    ];
    const howTo = {
      '@context': 'https://schema.org',
      '@type': 'HowTo',
      name: 'How to Deposit Assets to Mezo',
      mainEntityOfPage: url,
      url,
      step: steps,
    };
    return <script type="application/ld+json" set:html={JSON.stringify(howTo)} />;
  })()
}

{
  // SSR FAQPage for FAQs page
}
{
  (() => {
    const siteHref = Astro.site?.href ?? 'https://mezo.org/docs';
    const origin = new URL(siteHref).origin;
    const path = Astro.url.pathname.replace(/\/$/, '');
    if (path !== '/docs/users/resources/faqs') return null;
    const url = origin + path;
    const faq = {
      '@context': 'https://schema.org',
      '@type': 'FAQPage',
      mainEntityOfPage: url,
      url,
      mainEntity: [
        { '@type': 'Question', name: 'What is Mezo?', acceptedAnswer: { '@type': 'Answer', text: 'Mezo is a Bitcoin-centric platform enabling borrowing, spending, and building on Bitcoin.' } },
        { '@type': 'Question', name: 'What is MUSD?', acceptedAnswer: { '@type': 'Answer', text: 'MUSD is Mezoâ€™s Bitcoin-backed stablecoin used for borrowing and payments.' } }
      ],
    };
    return <script type="application/ld+json" set:html={JSON.stringify(faq)} />;
  })()
}


